# S-03: VOD 목록
version: "2.0"

screen:
  id: S-03
  name: VOD 목록
  route: /vod
  layout: single-column
  auth_required: false

# ============================================
# 데이터 요구사항
# ============================================
data_requirements:
  - resource: meetings
    alias: vod_list
    needs: [id, title, meeting_date, vod_url, status, duration_seconds]
    filters:
      status: [processing, ended]
      page: "?page"
    sort: { meeting_date: desc }
    pagination:
      per_page: 10
    description: VOD 목록 (페이지네이션)

# ============================================
# 컴포넌트
# ============================================
components:
  - id: header
    type: shared
    ref: shared/header
    props:
      show_search: false
      title: "VOD 목록"
      show_register_button: true

  - id: vod_table
    type: table
    position: main
    function: VOD 목록 테이블 표시
    data_source:
      resource: vod_list
    columns:
      - field: meeting_date
        label: 날짜
        format: date
      - field: title
        label: 제목
      - field: duration_seconds
        label: 재생시간
        format: duration_hhmmss
      - field: status
        label: 자막 상태
        render: subtitle_status_badge
    events:
      - on: click:row
        do: navigate(/vod/{row.id})

  - id: pagination
    type: pagination
    position: main
    data_source:
      resource: vod_list
    events:
      - on: page_change
        do: update_url_param(page)

  - id: register_button
    type: button
    position: header
    label: VOD 등록
    variant: primary
    events:
      - on: click
        do: open_modal(vod_register)

  - id: toast
    type: shared
    ref: shared/toast

# ============================================
# 연결점 (Navigation)
# ============================================
navigation:
  incoming:
    - from: /
      via: click:view_all
    - from: /vod/:id
      via: back_button
  outgoing:
    - to: /
      trigger: click:logo
    - to: /vod/:id
      trigger: click:vod_row
    - to: modal:vod_register
      trigger: click:register_button

# ============================================
# 상태 처리
# ============================================
states:
  empty:
    condition: vod_list.length == 0
    display:
      message: "등록된 VOD가 없습니다. 첫 번째 VOD를 등록해보세요!"
      action:
        label: "등록하기"
        event: open_modal(vod_register)

  loading:
    condition: vod_list.loading
    display: skeleton_table(rows: 5)

# ============================================
# 자막 상태 배지 렌더링
# ============================================
badge_rules:
  subtitle_status_badge:
    - condition: status == "ended"
      display: { icon: "check", text: "자막완료", color: "success" }
    - condition: status == "processing"
      display: { icon: "spinner", text: "자막생성중", color: "warning" }
    - condition: status == "scheduled"
      display: { icon: "x", text: "자막없음", color: "gray" }

# ============================================
# 테스트 시나리오
# ============================================
tests:
  - name: 초기 로드
    when: /vod 접속
    then:
      - VOD 목록 10개 표시
      - 날짜 내림차순 정렬
      - 페이지네이션 표시

  - name: VOD 항목 클릭
    when: VOD 행 클릭
    then: /vod/:id 페이지로 이동

  - name: 페이지 변경
    when: 2페이지 클릭
    then:
      - URL ?page=2 업데이트
      - 11-20번째 VOD 표시

  - name: 빈 상태
    when: VOD 없음
    then: 빈 상태 메시지 + 등록 버튼 표시
