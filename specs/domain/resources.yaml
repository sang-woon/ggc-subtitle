# Domain Resources v2.0
# 경기도의회 실시간 자막 서비스

version: "2.0"

resources:
  # ============================================
  # meetings - 회의 정보
  # ============================================
  meetings:
    description: 회의 정보 (실시간/VOD)
    endpoints:
      - method: GET
        path: /api/meetings
        description: 회의 목록 조회
        params:
          status: { type: string, enum: [scheduled, live, processing, ended] }
          limit: { type: integer, default: 10 }
          offset: { type: integer, default: 0 }
      - method: GET
        path: /api/meetings/live
        description: 현재 실시간 회의 조회
      - method: GET
        path: /api/meetings/{id}
        description: 회의 상세 조회
      - method: POST
        path: /api/meetings
        description: VOD 회의 등록
    fields:
      id: { type: uuid, required: true }
      title: { type: string, required: true, max_length: 255 }
      meeting_date: { type: date, required: true }
      stream_url: { type: string, nullable: true }
      vod_url: { type: string, nullable: true }
      status: { type: string, enum: [scheduled, live, processing, ended], default: scheduled }
      duration_seconds: { type: integer, nullable: true }
      created_at: { type: datetime }
      updated_at: { type: datetime }

  # ============================================
  # subtitles - 자막 데이터
  # ============================================
  subtitles:
    description: 자막 텍스트 및 타임스탬프
    endpoints:
      - method: GET
        path: /api/meetings/{meeting_id}/subtitles
        description: 회의별 자막 목록
        params:
          limit: { type: integer, default: 100 }
          offset: { type: integer, default: 0 }
      - method: GET
        path: /api/meetings/{meeting_id}/subtitles/search
        description: 자막 내 키워드 검색
        params:
          q: { type: string, required: true }
      - method: WS
        path: /ws/meetings/{meeting_id}/subtitles
        description: 실시간 자막 WebSocket
    fields:
      id: { type: uuid, required: true }
      meeting_id: { type: uuid, required: true, ref: meetings }
      start_time: { type: float, required: true, description: "시작 시간 (초)" }
      end_time: { type: float, required: true, description: "종료 시간 (초)" }
      text: { type: string, required: true }
      speaker: { type: string, nullable: true }
      confidence: { type: float, nullable: true, min: 0, max: 1 }
      created_at: { type: datetime }

  # ============================================
  # councilors - 의원 명단 (Whisper prompt용)
  # ============================================
  councilors:
    description: 의원 명단 (Whisper 프롬프트 및 화자 식별용)
    endpoints:
      - method: GET
        path: /api/councilors
        description: 의원 목록 조회
        params:
          term: { type: integer }
          is_active: { type: boolean, default: true }
    fields:
      id: { type: uuid, required: true }
      name: { type: string, required: true, max_length: 100 }
      party: { type: string, nullable: true, max_length: 100 }
      district: { type: string, nullable: true, max_length: 200 }
      term: { type: integer, nullable: true }
      is_active: { type: boolean, default: true }

  # ============================================
  # dictionary - 용어 교정 사전
  # ============================================
  dictionary:
    description: 의회 용어 교정 사전 (Whisper 후처리용)
    endpoints:
      - method: GET
        path: /api/dictionary
        description: 교정 사전 조회
        params:
          category: { type: string }
    fields:
      id: { type: uuid, required: true }
      wrong_text: { type: string, required: true, max_length: 200 }
      correct_text: { type: string, required: true, max_length: 200 }
      category: { type: string, nullable: true, enum: [councilor, term, general] }
      created_at: { type: datetime }

# ============================================
# WebSocket Events
# ============================================
websocket_events:
  subtitle_created:
    description: 새 자막 생성됨
    payload:
      - subtitle: { ref: subtitles }

  meeting_status_changed:
    description: 회의 상태 변경됨
    payload:
      - meeting_id: { type: uuid }
      - status: { type: string, enum: [scheduled, live, processing, ended] }

# ============================================
# External APIs (참고용)
# ============================================
external_apis:
  ggc_stream:
    description: 경기도의회 실시간 스트림
    base_url: https://stream01.cdn.gov-ntruss.com
    endpoints:
      - path: /live/{channel}/playlist.m3u8
        description: HLS 스트림

  ggc_vod:
    description: 경기도의회 VOD
    base_url: https://kms.ggc.go.kr
    endpoints:
      - path: /mp4/{filename}
        description: VOD MP4 파일

  openai_whisper:
    description: OpenAI Whisper API
    base_url: https://api.openai.com/v1
    endpoints:
      - path: /audio/transcriptions
        description: 음성-텍스트 변환
